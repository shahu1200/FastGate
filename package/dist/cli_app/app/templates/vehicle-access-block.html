{% extends "base.html" %}

{% block content %}
<script>
  function allDaySelected(){
    if ($('input[name=alldays]').is(':checked'))
    {
      document.getElementsByName("chek[]").disabled = true;
    }
    else
    {
      document.getElementsByName("chek[]").disabled = false;
    }
  }

  function myFunction() {
  var weekDaysStr = "";
  if ($('input[name=alldays]').is(':checked'))
  {
    weekDaysStr = "A";
  }
  else
  {
    var weekdays = $('input[type=checkbox]').serializeArray();
    console.log("see if nothing is checked");
    console.log(weekdays); 
    $.each(weekdays, function(i, n){
      weekDaysStr = n['value'] + "-" + weekDaysStr;
    });
  }
  // console.log("see if nothing is checked weekdaysstring");
  // console.log(weekDaysStr); 
  var formdatas = ($('input').serializeArray());
  var formdict = {};
  
  console.log(formdatas); 
  var keys = "";
  var vals = "";
  
  $.each(formdatas, function(i, n){
    keys = n['name'];
    
    if (keys.includes("Date")){vals=dateformats(n['value']) + " 00:00:00";}
    else if (keys.includes("Time")){vals=n['value'] + ":00";}else{vals=n['value'];}
    
    formdict[keys] = vals;
  });

  formdict["weekDay"] = weekDaysStr;
  formdict["tagId"] = $('select[name=vehicle]').val();

  fetch("/api/vehicle_accessblock_put",{
    method: "POST",
    body: JSON.stringify(formdict),
    headers: {
      'Content-Type': 'application/json'
  }
  }).then(function (response) {
      if (response.status !== 200) {
        console.log(`Looks like there was a problem. Status code: ${response.status}`);
        return;
      }
      response.json().then(function (data) {
        console.log(data);
        alert("Successfully added User Vehicle schedule!");
      });
    })
  }
</script>
  <!--header end-->

    <!--form start-->

    <div class="global-container">
      <div class="card login-form">
      <div class="card-body">
        <h3 class="card-title text-center">Vehicle Access / Block</h3> <hr>
        <div class="card-text">
          <!--
          <div class="alert alert-danger alert-dismissible fade show" role="alert">Incorrect username or password.</div> -->
          <!--radio start-->
         <div class="row">
           <div class="col-md-12" style="text-align: center;">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="accessBlk" id="inlineRadio1" value="1" checked>
              <label class="form-check-label" for="inlineRadio1">Access</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="accessBlk" id="inlineRadio2" value="2">
              <label class="form-check-label" for="inlineRadio2">Block</label>
            </div>
           </div>
         </div>
         <!--radio end-->

            <!-- to error: add class "has-danger" -->
            <div class="form-group">
              <label for="exampleInputEmail1" style="font-weight: 600;"></label>
              <label for="inputState" style="font-weight: 600;">Select Vehicle</label>
              <select id="inputState" class="form-control" name="vehicle">
               <option value="NA" selected>NA</option>
                {% for tagid, owner in data["vehiclelist"] %}
                  {% if tagid != null %}
                    <option value={{tagid}}>{{tagid}} / {{owner}}</option>
                  {% endif %}
                {% endfor %}
                </select>
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1" style="font-weight: 600;">Start Date</label>
              
              <input type="date" name="fromDate" class="form-control form-control-sm" id="exampleInputPassword1">
              
            </div>
            <div class="form-group">
                <label for="exampleInputPassword1" style="font-weight: 600;">End Date</label>
                
                <input type="date" name="toDate" id="toDate" class="form-control form-control-sm date">
                
              </div> 
              <div class="form-group">
                <label for="exampleInputPassword1" style="font-weight: 600;">Start Time</label>
                
                <input type="time" name="fromTime" class="form-control form-control-sm" id="exampleInputPassword1">
                
              </div>
              <div class="form-group">
                <label for="exampleInputPassword1" style="font-weight: 600;">End Time</label>
                
                <input type="time" name="toTime" class="form-control form-control-sm" id="exampleInputPassword1">
                
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1"  style="font-weight: 600;">Select Days</label>
                                  
                <div class="dropdown cq-dropdown" data-name='statuses'>
 
                  <input type="text" class="dropdown-toggle form-control"  id="btndropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="btndropdown" style="padding: 13px;">
                    
                    <li>
                      <label class="radio-btn">
                          <input type="checkbox" name="alldays" value='A' onclick="allDaySelected()">
                          All Days
                      </label>         
                    </li>
                    
                    <li>
                        <label class="radio-btn">
                            <input type="checkbox" name="chek[]" value='1'>
                            Monday
                        </label>           
                    </li>
           
                    <li>           
                        <label class="radio-btn">           
                            <input type="checkbox" name="chek[]" value='2'>           
                            Tuesday           
                        </label>           
                    </li>
           
                    <li>           
                        <label class="radio-btn">           
                            <input type="checkbox" name="chek[]" value='3'>           
                            Wednesday           
                        </label>           
                    </li>

                    <li>           
                        <label class="radio-btn">           
                            <input type="checkbox" name="chek[]" value='4'>           
                            Thursday           
                        </label>           
                    </li>
           
                    <li>           
                        <label class="radio-btn">           
                            <input type="checkbox" name="chek[]" value='5'>           
                            Friday           
                        </label>           
                    </li>

                    <li>           
                      <label class="radio-btn">         
                          <input type="checkbox" name="chek[]" value='6'>         
                          Saturday         
                      </label>         
                    </li>

                    <li>           
                      <label class="radio-btn">       
                        <input type="checkbox" name="chek[]" value='7'>       
                        Sunday       
                      </label>       
                    </li>

                  </ul>
           
                </div>
              </div><br>
            <button type="submit" class="btn btn-warning btn-block" style="font-weight: 600;" onclick="myFunction()">Save</button>
            <button type="submit" class="btn btn-light btn-block">Cancel</button>
            
            
        </div>
      </div>
    </div>
    </div>
    
   <!--form end--> 
   {% endblock %}